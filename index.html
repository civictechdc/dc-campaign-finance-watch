<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <title>DC Campaign Finance Watch</title>

    <script src="bower_components/platform/platform.js"></script>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="import" href="elements/elements.html">
  </head>

  <body unresolved fullbleed>
    <template is="auto-binding" id="page-template">
      <core-scaffold theme="core-light-theme">
        <core-header-panel navigation flex mode="seamed">
          <core-toolbar theme="core-light-theme"></core-toolbar>
          <core-menu theme="core-light-theme" on-core-select="{{handleSelect}}">
            <core-ajax auto url="json/years and offices.json" response="{{items}}" handleAs="json"></core-ajax>
            <template repeat="{{item in items}}">
              <core-submenu icon="visibility" label="{{item.year}}">
                <template repeat="{{office in item.offices}}">
                  <core-item id="{{ office + '-' + item.year | replaceSpaces }}" label="{{office}}"></core-item>
                </template>
              </core-submenu>
            </template>
          </core-menu>
        </core-header-panel>
        <div tool>{{title}}</div>
        <core-ajax auto url="json/graphing-data.json" response="{{races}}" handleAs="json"></core-ajax>
        <core-pages selected="{{selectedPageId}}" valueattr="id">
          <template repeat="{{race in races}}">
            <div id="page-{{race.officeyearid}}">
              <my-charts charts="{{race.officeyeardata}}"></my-charts>
            </div>
          </template>
        </core-pages>
      </core-scaffold>
    </template>

    <script>
      	var template = document.querySelector('#page-template');
        template.title = 'DC Campaign Finance Watch';

        template.replaceSpaces = function(str) {
        	return str.replace(/\s/g, '-');
      	},

        template.handleSelect = function(e) {
          if(e.detail.isSelected && e.detail.item.localName == 'core-item') {
            this.selectedPageId = 'page-' + e.detail.item.id;
          }
        };
    </script>

  </body>

</html>
